<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#343a40">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="favicon.ico">
    <title>ErgoApp</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-info">
    <nav class="navbar navbar-dark bg-dark mb-4" style="align-items:baseline">
        <div class="container">
            <a href="index.php" class="navbar-brand mb-0 h1">ErgoApp</a>
            <div class="navbar__rightPart text-white d-flex align-items-baseline">
                <span class="d-none d-sm-block">User: username</span>
                <button class="btn btn-danger d-none d-sm-block ml-4" onclick="ModalLogoutShow()">Logout</button>

                <span class="dropdown-toggle d-block d-sm-none text-truncate" id="dropdownUserButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="max-width:160px">
            User: username          </span>
                <div class="dropdown-menu dropdown-menu-right bg-dark p-2" aria-labelledby="dropdownUserButton">
                    <button class="btn btn-danger btn-block" onclick="ModalLogoutShow()">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <section class="content container pb-4" id="authorized">
        <h2 class="text-center">Project #<span id="id_project">57</span> - result</h2>
        <button type="button" class="btn btn-outline-dark" onclick="ModalCreateProjectShow()">New project</button>
        <button type="button" class="btn btn-warning d-none d-sm-inline" onclick="ModalDownloadPDFShow()">Download PDF</button>
        <button type="button" class="btn btn-danger" onclick="ModalDeleteProjectShow()">Delete project</button>

        <hr>
        <div id="result">
            <h6>Room data</h6>
            <table>
                <tr>
                    <td>House number:</td>
                    <td id="house">5</td>
                </tr>
                <tr>
                    <td>Floor:</td>
                    <td id="floor">9</td>
                </tr>
                <tr>
                    <td>Apartment:</td>
                    <td id="apartment">980</td>
                </tr>
                <tr>
                    <td>Room:</td>
                    <td id="room">1</td>
                </tr>
            </table>
            <hr>

            <h6>Room size</h6>
            <table>
                <tr>
                    <td>Width (m):</td>
                    <td id="width">8,10</td>
                </tr>
                <tr>
                    <td>Length (m):</td>
                    <td id="length">4,60</td>
                </tr>
                <tr>
                    <td>Height (m):</td>
                    <td id="height">2,90</td>
                </tr>
                <tr>
                    <td>Area (m2):</td>
                    <td id="area">37,26</td>
                </tr>
                <tr>
                    <td>Volume (m3):</td>
                    <td id="volume">108,054</td>
                </tr>
            </table>
            <hr>

            <h6>Set of equipment</h6>
            <table>
                <tr>
                    <td>Computers:</td>
                    <td id="computers">2</td>
                </tr>
                <tr>
                    <td>Tables:</td>
                    <td id="tables">2</td>
                </tr>
                <tr>
                    <td>Chairs:</td>
                    <td id="chairs">2</td>
                </tr>
                <tr>
                    <td>Thumbs:</td>
                    <td id="thumbs">1</td>
                </tr>
                <tr>
                    <td>Cabinets:</td>
                    <td id="cabinets">1</td>
                </tr>
            </table>
            <hr>

            <h6>Set of room exits</h6>
            <table>
                <tr>
                    <td>Number of windows:</td>
                    <td id="windows">1</td>
                </tr>
                <tr>
                    <td>Number of doors:</td>
                    <td id="doors">1</td>
                </tr>
            </table>
        </div>
    </section>

    <section class="content container py-4 d-none" id="not-authorized">
        <div class="jumbotron">
            <h1 class="display-4 text-center" id="not-authorized__text"></h1>
        </div>
    </section>



    <footer class="footer d-flex flex-wrap align-content-center bg-dark text-white text-center">
        <div class="container align-self-center">
            Copyright &#9400; Serhii Sokol. Praca Dyplomowa Magisterska / 2019
        </div>
    </footer>



    <!-- Modal LOGOUT -->
    <div class="modal fade" id="modalLogout" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header bg-danger text-white">
                    <h4 class="modal-title">Logout</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p>Do you really want to logout?</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <a href="userAccount.php?logoutSubmit=1" class="btn btn-success">Yes</a>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal DOWNLOAD PDF -->
    <div class="modal fade" id="modalDownloadPdf" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header bg-warning text-white">
                    <h4 class="modal-title">Download PDF</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p>Do you really want to download PDF?</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal" onclick="Download()">Yes</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal DELETE PROJECT -->
    <div class="modal fade" id="modalDeleteProject" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header bg-danger text-white">
                    <h4 class="modal-title">Delete project</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p>Do you really want to delete project <b id="modalDeleteProject__idProject"></b>?</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <a href="project-delete.php" id="btnDeleteProject" class="btn btn-success" data-dismiss="modal">Yes</a>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal CREATE PROJECT -->
    <div class="modal fade" id="modalCreateProject" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header bg-success text-white">
                    <h4 class="modal-title">Create project</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p>Do you really want to create project?</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <a href="main.php" class="btn btn-success">Yes</a>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                </div>

            </div>
        </div>
    </div>

    <noscript style="background-color: red;">
    <strong>We're sorry but application "ErgoApp" doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
  </noscript>

    <script src="js/jquery-3.1.1.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.54/pdfmake.js"></script>
    <script src="js/vfs_fonts.js"></script>

    <script>
        $(document).ready(function() {
            GetResult();
        });

        function GetResult() {
            let project_id = '54';
            let username_id = '16';

            $.ajax({
                url: "get-result.php",
                type: "POST",
                data: {
                    project_id: project_id
                },

                success: function(result) {
                    if (result.status === "Error") {
                        alert(result.message);
                    } else if (result.status === "Success" && result.project === null) {
                        $("#authorized").addClass("d-none");
                        $("#not-authorized__text").text("Sorry, there is no such project.");
                        $("#not-authorized").removeClass("d-none");
                    } else if (result.status === "Success" && result.project !== null) {
                        let id_project = result.project.id;

                        let house = result.project.house;
                        let floor = result.project.floor;
                        let apartment = result.project.apartment;
                        let room = result.project.room;

                        let width = result.project.width;
                        let length = result.project.length;
                        let height = result.project.height;
                        let area = width * length;
                        let volume = (width * length * height).toFixed(3);

                        let computers = result.project.computers;
                        let tables = result.project.tables;
                        let chairs = result.project.chairs;
                        let thumbs = result.project.thumbs;
                        let cabinets = result.project.cabinets;

                        let windows = result.project.windows;
                        let doors = result.project.doors;

                        $("#id_project").text(id_project);

                        $("#house").text(house);
                        $("#floor").text(floor);
                        $("#apartment").text(apartment);
                        $("#room").text(room);

                        $("#width").text(width);
                        $("#length").text(length);
                        $("#height").text(height);
                        $("#area").text(area);
                        $("#volume").text(volume);

                        $("#computers").text(computers);
                        $("#tables").text(tables);
                        $("#chairs").text(chairs);
                        $("#thumbs").text(thumbs);
                        $("#cabinets").text(cabinets);

                        $("#windows").text(windows);
                        $("#doors").text(doors);

                        if (username_id !== result.project.username_id) {
                            $("#authorized").addClass("d-none");
                            $("#not-authorized__text").text("Authorized user does not have access to this project.");
                            $("#not-authorized").removeClass("d-none");
                        }
                    }
                },
                error: function(jqXHR, exception) {
                    console.log("Error Message:", jqXHR, exception);
                },
                complete: function(data) {
                    // console.log('function complete');
                }
            });
        };

        function Download() {
            let dd = {
                content: [{
                    text: 'ErgoApp\n\n',
                    style: 'header'
                }, {
                    style: 'tableFirstStyle',
                    table: {
                        body: [
                            ['Username:', "username"],
                            ['Project #:', $("#id_project").text()]
                        ]
                    },
                    layout: 'noBorders'
                }, {
                    text: 'Room data',
                    bold: 'subheader'
                }, {
                    style: 'tableStyle',
                    table: {
                        body: [
                            ['House number:', $("#house").text()],
                            ['Floor:', $("#floor").text()],
                            ['Apartment:', $("#apartment").text()],
                            ['Room:', $("#room").text()]
                        ]
                    },
                    layout: 'noBorders'
                }, {
                    text: 'Room size',
                    bold: 'subheader'
                }, {
                    style: 'tableStyle',
                    table: {
                        body: [
                            ['Width (m):', $("#width").text()],
                            ['Length (m):', $("#length").text()],
                            ['Height (m):', $("#height").text()],
                            ['Area (m2):', $("#area").text()],
                            ['Volume (m3):', $("#volume").text()]
                        ]
                    },
                    layout: 'noBorders'
                }, {
                    text: 'Set of equipment',
                    bold: 'subheader'
                }, {
                    style: 'tableStyle',
                    table: {
                        body: [
                            ['Computer:', $("#computer").text()],
                            ['Tables:', $("#tables").text()],
                            ['Chairs:', $("#chairs").text()],
                            ['Thumbs:', $("#thumbs").text()],
                            ['Cabinets:', $("#cabinets").text()]
                        ]
                    },
                    layout: 'noBorders'
                }, {
                    text: 'Set of room exits',
                    bold: 'subheader'
                }, {
                    style: 'tableStyle',
                    table: {
                        body: [
                            ['Number of windows:', $("#windows").text()],
                            ['Number of doors:', $("#doors").text()]
                        ]
                    },
                    layout: 'noBorders'
                }],
                styles: {
                    header: {
                        fontSize: 18,
                        bold: true,
                        alignment: 'center',
                        margin: [0, 0, 0, 10]
                    },
                    subheader: {
                        fontSize: 14,
                        bold: true,
                        margin: [0, 10, 0, 5]
                    },
                    tableStyle: {
                        margin: [0, 5, 0, 15]
                    },
                    tableFirstStyle: {
                        fontSize: 14,
                        bold: true,
                        margin: [0, 0, 0, 50]
                    }
                }
            };
            pdfMake.createPdf(dd).download('Project #' + 54 + '.pdf');
        };

        $("#btnDeleteProject").bind("click", function() {
            let project_id = $("#id_project").text();

            $.ajax({
                url: "project-delete.php",
                type: "POST",
                data: {
                    project_id: project_id
                },
                success: function(result) {
                    if (result.status === "Error") {
                        alert(result.message);
                    } else if (result.status === "Success") {
                        window.location = "/index.php";
                    }
                    return false;
                },
                error: function(jqXHR, exception) {
                    console.log("Error Message:", jqXHR, exception);
                },
                complete: function(data) {
                    // console.log('function complete');
                }
            });
            return false
        });

        function ModalLogoutShow() {
            $("#modalLogout").modal("show");
        };

        function ModalDownloadPDFShow() {
            $("#modalDownloadPdf").modal("show");
        };

        function ModalDeleteProjectShow() {
            let id_project = $("#id_project").text();
            $("#modalDeleteProject__idProject").text("#" + id_project);
            $("#modalDeleteProject").modal("show");
        };

        function ModalCreateProjectShow() {
            $("#modalCreateProject").modal("show");
        };
    </script>
</body>

</html>